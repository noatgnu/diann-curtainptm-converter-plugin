# Slivka service configuration for diann-curtainptm-converter
# Generated from Cauldron plugin format
#
# For file inputs that reference large databases (e.g., FASTA databases),
# consider configuring them as environment variables pointing to shared storage:
#   env:
#     DATABASE_PATH: "${SLIVKA_HOME}/databases/uniref90.fasta"
# Then reference in args as: arg: "--db=${DATABASE_PATH}"

slivka-version: "0.8"
name: diann-curtainptm-converter
description: Convert DIA-NN PTM differential analysis output to CurtainPTM upload format. Processes modified sequences, maps PTM positions to protein sequences, and generates sequence windows around modification sites. Based on: Phung et al. (2024) PNAS 121(7):e2312676121. Repository: https://github.com/noatgnu/curtain-utils
author: CauldronGO Team
version: "1.0.0"
license: MIT
classifiers:
  - "Topic :: Scientific/Engineering :: Bio-Informatics"

parameters:
  pr_file:
    name: "PR File (Differential Analysis)"
    description: "DIA-NN precursor-level differential analysis file containing Modified.Sequence, Precursor.Id, and Protein.Group columns"
    type: file
    required: true
    media-type: text/tab-separated-values
  report_file:
    name: "Report File (Optional)"
    description: "DIA-NN report file containing protein sequences and PTM.Site.Confidence scores"
    type: file
    media-type: text/tab-separated-values
  modification_type:
    name: "Modification Type"
    description: "Type of modification to process using UniMod identifier (e.g., UniMod:21 for Phosphorylation, UniMod:1 for Acetylation, UniMod:35 for Oxidation, UniMod:4 for Carbamidomethyl)"
    type: text
    required: true
    default: UniMod:21
  fasta_file:
    name: "FASTA File (Optional)"
    description: "Protein sequence FASTA file. If not provided, sequences will be fetched from UniProt automatically."
    type: file
    media-type: application/fasta
  localization_score_col:
    name: "Localization Score Column"
    description: "Column name containing PTM site confidence scores in the report file"
    type: text
    default: PTM.Site.Confidence
  multiple_site:
    name: "Process Multiple Sites"
    description: "Enable this to process peptides with multiple modification sites. When enabled, all sites will be reported in semicolon-separated format."
    type: boolean
    default: false
  uniprot_columns:
    name: "UniProt Data Columns"
    description: "Comma-separated list of UniProt columns to retrieve when fetching sequences online"
    type: text
    default: accession,id,sequence,protein_name
  output_filename:
    name: "Output Filename"
    description: "Name of the output file (will be created in the output folder)"
    type: text
    default: curtainptm_input.txt
  output_meta:
    name: "Output Metadata File"
    description: "Generate an additional metadata file with intensity information from the report file. Only works when a report file is provided."
    type: boolean
    default: false
  sequence_window_size:
    name: "Sequence Window Size"
    description: "Size of the sequence window around modification sites (must be odd number). Default is 21 (10 residues before + modification + 10 after)."
    type: float
    default: 21
    min: 1
    max: 101

command:
  - python
  - convert.py

args:
  _output_dir:
    arg: "--output_folder=."

outputs:
  converted_file:
    path: "*.txt"
    media-type: text/tab-separated-values

execution:
  runners:
    default:
      type: SlivkaQueueRunner
